{% extends "base.html" %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1><span>üë•</span> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h1>
                <a href="{{ url_for('create_user') }}" class="btn btn-success">
                    <span>‚ûï</span> –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                </a>
            </div>
            
            <!-- Flash messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">–°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</th>
                                    <th>–†–æ–ª—å</th>
                                    <th>–°—Ç–∞—Ç—É—Å</th>
                                    <th>–ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥</th>
                                    <th>–ü–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞</th>
                                    <th>–°–æ–∑–¥–∞–Ω</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for user in users %}
                                <tr>
                                    <td>{{ user.id }}</td>
                                    <td>
                                        <strong>{{ user.username }}</strong>
                                        {% if user.id == current_user.id %}
                                            <span class="badge bg-primary">–í—ã</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if user.role.value == 'superadmin' %}
                                            <span class="badge bg-danger">–°—É–ø–µ—Ä–∞–¥–º–∏–Ω</span>
                                        {% elif user.role.value == 'admin' %}
                                            <span class="badge bg-warning">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                                        {% elif user.role.value == 'user' %}
                                            <span class="badge bg-info">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span>
                                        {% else %}
                                            <span class="badge bg-secondary">–ü—Ä–æ—Å–º–æ—Ç—Ä</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if user.is_locked() %}
                                            <span class="badge bg-danger">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>
                                        {% elif user.is_active %}
                                            <span class="badge bg-success">–ê–∫—Ç–∏–≤–µ–Ω</span>
                                        {% else %}
                                            <span class="badge bg-secondary">–ù–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if user.last_login %}
                                            {{ user.last_login.strftime('%d.%m.%Y %H:%M') }}
                                        {% else %}
                                            <em>–ù–∏–∫–æ–≥–¥–∞</em>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if user.login_attempts > 0 %}
                                            <span class="badge bg-warning">{{ user.login_attempts }}/5</span>
                                        {% else %}
                                            <span class="badge bg-success">0/5</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ user.created_at.strftime('%d.%m.%Y %H:%M') }}</td>
                                    <td>
                                        <div class="btn-group btn-group-sm" role="group">
                                            <a href="{{ url_for('edit_user', user_id=user.id) }}" 
                                               class="btn btn-outline-primary" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                                <span>‚úèÔ∏è</span>
                                            </a>
                                            
                                            {% if user.is_locked() %}
                                                <form method="POST" action="{{ url_for('unlock_user', user_id=user.id) }}" 
                                                      style="display: inline;">
                                                    <button type="submit" class="btn btn-outline-success" 
                                                            title="–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å">
                                                        <span>üîì</span>
                                                    </button>
                                                </form>
                                            {% endif %}
                                            
                                            <a href="{{ url_for('reset_password', user_id=user.id) }}" 
                                               class="btn btn-outline-warning" title="–°–±—Ä–æ—Å–∏—Ç—å –ø–∞—Ä–æ–ª—å">
                                                <span>üîë</span>
                                            </a>
                                            
                                            {% if user.id != current_user.id %}
                                                <form method="POST" action="{{ url_for('delete_user', user_id=user.id) }}" 
                                                      style="display: inline;" 
                                                      onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {{ user.username }}?')">
                                                    <button type="submit" class="btn btn-outline-danger" 
                                                            title="–£–¥–∞–ª–∏—Ç—å">
                                                        <span>üóëÔ∏è</span>
                                                    </button>
                                                </form>
                                            {% endif %}
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">–û–ø–∏—Å–∞–Ω–∏–µ —Ä–æ–ª–µ–π</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-unstyled">
                                <li><span class="badge bg-danger">–°—É–ø–µ—Ä–∞–¥–º–∏–Ω</span> - –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º</li>
                                <li><span class="badge bg-warning">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span> - –ù–∞—Å—Ç—Ä–æ–π–∫–∏, –∂—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞</li>
                                <li><span class="badge bg-info">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</span> - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∞–¥—Ä–µ—Å–æ–≤</li>
                                <li><span class="badge bg-secondary">–ü—Ä–æ—Å–º–æ—Ç—Ä</span> - –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–∞–Ω–Ω—ã—Ö</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-unstyled">
                                <li><span class="text-success">üõ°Ô∏è</span> –ê–≤—Ç–æ–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ—Å–ª–µ 5 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫</li>
                                <li><span class="text-info">üìã</span> –ü–æ–ª–Ω—ã–π –∂—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞ –¥–µ–π—Å—Ç–≤–∏–π</li>
                                <li><span class="text-warning">üîê</span> –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π</li>
                                <li><span class="text-danger">üîí</span> –ó–∞—â–∏—Ç–∞ –æ—Ç —Å–∞–º–æ—É–¥–∞–ª–µ–Ω–∏—è</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}